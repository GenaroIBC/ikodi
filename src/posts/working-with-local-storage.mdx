---
title: "Working with the Local Storage API in JavaScript"
date: "2022-11-30"
---

# Working with the Local Storage API in JavaScript

_Local Storage_ is an **browser API** that let us **persist information** in the
browser storage, allowing us to save useful information about _user
preferences_, such as theme, language, etc...

As you can imagine, it is a very convenient way to personalize user experience.

---

## Getting Started

The way Local Storage stores data is similar to an ordinary JavaScript object, that is a set of _key_ and _value_ pairs:

```javascript
const object = {
  firstKey: "hello",
  secondKey: "world"
};
```

<br />

We can access the Local Storage data table directly in the browser DevTools:

1. Open a new empty tab
1. Go to the developer tools.
1. Navigate to _Application > Storage > Local Storage_
   ![Application window](/img/first.png)
1. Select the first URL from the list
   ![URLs list](/img/second.png)

You can see something like this:
![Local Storage data table](/img/third.png)

<br />

To add a new key/value pair, double click below the _key_ column and enter a key (for example _"message"_). Then go to the _value_ field and enter a value (for example _"local storage"_).

If we reload the page, we can see that the data we've just added is still there:
![Data is still there](/img/fourth.png)

<br />

Now: how can we bring this to JavaScript?

Well, it's pretty simple, but you need to know something very important first: **Local Storage can only store data as a _`string`_**, so we need to stringify it first.

The way JavaScript lets us do it is via the global `JSON` object methods:

- `JSON.stringify()` accepts a valid JavaScript value (object, array, number, etc...) and returns a stringified copy:

```javascript
JSON.stringify({
  name: "foo",
  age: 23
}); // returns "{name:"foo",age:23}"
```

- `JSON.parse()` accepts a valid **stringified** JavaScript
  value and returns its equivalent JavaScript value:

```javascript
JSON.parse("{name:'foo',age:23}"); // returns {
//   name: "foo",
//   age: 23
// }
```

<br />

With this in mind, we are ready to interact with the Local Storage via JavaScript.

The Local Storage API provides us the following methods:

```javascript
localStorage.setItem(<key>, <stringified-data>) // to save data

localStorage.getItem(<key>) // to get saved data by key

localStorage.key(<index>) // to get saved data by index

localStorage.removeItem(<key>) // to remove saved data

localStorage.clear() // to empty storage
```

<br />

So, let's imagine a real-world example: We need to remember the user's preferred language every time they enter the app.

For this example, i'm going to use vanila JS, but it is easily extrapolated to any library/framework.

> HTML:

```html
<select name="language" id="language-select">
  <option value="en">English</option>
  <option value="es">Español</option>
  <option value="pt">Português</option>
  ...
</select>
```

We create a _select_ element with language options and we add it the _language-select_ id.

<br />

> JavaScript:

```javascript
// we listen for "change" events in the document
document.addEventListener("change", event => {
  // we check if the event comes from our select element
  if (event.target.matches("#language-select")) {
    // if so, we get the selected value
    const selectedLanguage = event.target.value;

    // and we save it in the Local Storage
    localStorage.setItem("language", selectedLanguage);
  }
});
```

With JavaScript, we add an _event listener_ for the entire document\*.

> \* When i work with vanila JavaScript, i add only one event listener for each event i need to handle. I do it in order to prevent _event propagation_ and reduce the number of event listeners in the app.

Once we've added our event listener, we check if the event target (the element that fired the event) is our _select_. If so, we get its value (in our example it would be _en_, _es_ or _pt_) and save it in the Local Storage.

<Note type="info">
  Note that we are not converting our value to a string because it is already a
  string.
</Note>

Now, we can do the following:

> JavaScript

```javascript
// we listen for "change" events in the document
document.addEventListener("DOMContentLoaded", event => {
  // we check if the event comes from our select element
  // if so, we stringify the selected value
  const stringifiedValue = JSON.stringify(event.target.value);

  const localStorage.getItem("language");
  // and we save it in the Local Storage
});
```
